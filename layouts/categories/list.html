{{ define "main" }}
    <header>
        <h3 class="section-title">{{ T "list.section" }}</h3>

        <div class="section-card">
            <div class="section-details">
                <h3 class="section-count">{{ T "list.page" (len .Site.Taxonomies.categories) }}</h3>
                <h1 class="section-term">{{ .Title }}</h1>
            </div>
        </div>
    </header>

    {{/* ê³„ì¸µ êµ¬ì¡° ë¹Œë“œ */}}
    {{ $hierarchy := dict }}

    {{/* ëª¨ë“  í˜ì´ì§€ë¥¼ ìˆœíšŒí•˜ë©° ë©”ì¸-ì„œë¸Œ êµ¬ì¡° íŒŒì‹± */}}
    {{ range .Site.RegularPages }}
        {{ $cats := .Params.categories }}
        {{ if ge (len $cats) 2 }}
            {{ $main := index $cats 0 }}
            {{ $sub := index $cats 1 }}

            {{/* ë©”ì¸ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™” */}}
            {{ if not (index $hierarchy $main) }}
                {{ $hierarchy = merge $hierarchy (dict $main (slice)) }}
            {{ end }}

            {{/* ì„œë¸Œ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€ëŠ” ë‚˜ì¤‘ì—) */}}
            {{ $subs := index $hierarchy $main }}
            {{ $subs = $subs | append $sub }}
            {{ $hierarchy = merge $hierarchy (dict $main $subs) }}
        {{ end }}
    {{ end }}

    {{/* ê³„ì¸µ êµ¬ì¡° í‘œì‹œ */}}
    <section class="hierarchical-categories">
        {{ range $mainCat, $subCats := $hierarchy }}
            {{ $subCats = uniq $subCats | sort }}

            <details class="category-group" open>
                <summary class="main-cat">
                    <span>ğŸ“ {{ $mainCat }}</span>
                </summary>
                <div class="sub-cats">
                    {{ range $subCat := $subCats }}
                        {{/* í•´ë‹¹ ì„œë¸Œ ì¹´í…Œê³ ë¦¬ì˜ í¬ìŠ¤íŠ¸ ìˆ˜ ê³„ì‚° */}}
                        {{ $count := 0 }}
                        {{ range $.Site.RegularPages }}
                            {{ $cats := .Params.categories }}
                            {{ if ge (len $cats) 2 }}
                                {{ if and (eq (index $cats 0) $mainCat) (eq (index $cats 1) $subCat) }}
                                    {{ $count = add $count 1 }}
                                {{ end }}
                            {{ end }}
                        {{ end }}

                        {{/* Hugo taxonomy URL ì‚¬ìš© */}}
                        {{ $subCatKey := $subCat | urlize }}
                        {{ with $.Site.Taxonomies.categories.Get $subCatKey }}
                            <a href="{{ .Page.RelPermalink }}" class="sub-cat-link">
                                <span>{{ $subCat }}</span>
                                <span class="count">({{ $count }})</span>
                            </a>
                        {{ end }}
                    {{ end }}
                </div>
            </details>
        {{ end }}
    </section>

    <style>
    .hierarchical-categories {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .category-group {
        background: var(--card-background);
        border-radius: var(--card-border-radius);
        padding: 1.5rem;
        box-shadow: var(--shadow-l1);
    }

    .main-cat {
        font-size: 1.3rem;
        font-weight: 600;
        cursor: pointer;
        list-style: none;
        color: var(--card-text-color-main);
    }

    .main-cat::-webkit-details-marker {
        display: none;
    }

    .sub-cats {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
        padding-left: 2rem;
    }

    .sub-cat-link {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        background: var(--body-background);
        border-radius: 6px;
        text-decoration: none;
        color: var(--card-text-color-main);
        transition: all 0.2s ease;
    }

    .sub-cat-link:hover {
        transform: translateX(4px);
        border-left: 3px solid var(--accent-color);
    }

    .count {
        color: var(--card-text-color-secondary);
    }
    </style>

    {{ partialCached "footer/footer" . }}
{{ end }}

{{ define "right-sidebar" }}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{ end }}
