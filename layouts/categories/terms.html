{{ define "main" }}
    <header>
        <h3 class="section-title">Categories</h3>
        <div class="section-card">
            <div class="section-details">
                <h1 class="section-term">{{ .Title }}</h1>
            </div>
        </div>
    </header>

    {{/* Scratchë¡œ ë©”ì¸/ì„œë¸Œ êµ¬ì¡° ìƒì„± */}}
    {{ $.Scratch.Set "mains" slice }}

    {{/* ë¨¼ì € ëª¨ë“  ë©”ì¸ ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘ */}}
    {{ range .Site.RegularPages }}
        {{ if .Params.categories }}
            {{ if ge (len .Params.categories) 2 }}
                {{ $main := index .Params.categories 0 }}
                {{ $currentMains := $.Scratch.Get "mains" }}
                {{ $found := false }}
                {{ range $currentMains }}
                    {{ if eq . $main }}
                        {{ $found = true }}
                    {{ end }}
                {{ end }}
                {{ if not $found }}
                    {{ $.Scratch.Add "mains" $main }}
                {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}

    <section class="hierarchical-categories-page">
        {{ $allMains := $.Scratch.Get "mains" }}
        {{ range sort $allMains }}
            {{ $mainName := . }}

            {{/* ì´ ë©”ì¸ ì¹´í…Œê³ ë¦¬ì˜ ì„œë¸Œë“¤ ì°¾ê¸° */}}
            {{ $.Scratch.Set "subs" slice }}
            {{ range $.Site.RegularPages }}
                {{ if .Params.categories }}
                    {{ if ge (len .Params.categories) 2 }}
                        {{ if eq (index .Params.categories 0) $mainName }}
                            {{ $sub := index .Params.categories 1 }}
                            {{ $currentSubs := $.Scratch.Get "subs" }}
                            {{ $foundSub := false }}
                            {{ range $currentSubs }}
                                {{ if eq . $sub }}
                                    {{ $foundSub = true }}
                                {{ end }}
                            {{ end }}
                            {{ if not $foundSub }}
                                {{ $.Scratch.Add "subs" $sub }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                {{ end }}
            {{ end }}

            <details class="main-category-block" open>
                <summary class="main-category-title">
                    <span class="category-icon">ğŸ“</span>
                    <a href="/categories/{{ $mainName | urlize }}/">{{ $mainName }}</a>
                </summary>

                <div class="sub-categories-list">
                    {{ $allSubs := $.Scratch.Get "subs" }}
                    {{ range sort $allSubs }}
                        {{ $subName := . }}

                        {{/* ì´ ì„œë¸Œ ì¹´í…Œê³ ë¦¬ì˜ í¬ìŠ¤íŠ¸ ìˆ˜ ê³„ì‚° */}}
                        {{ $count := 0 }}
                        {{ range $.Site.RegularPages }}
                            {{ if .Params.categories }}
                                {{ if ge (len .Params.categories) 2 }}
                                    {{ if and (eq (index .Params.categories 0) $mainName) (eq (index .Params.categories 1) $subName) }}
                                        {{ $count = add $count 1 }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ end }}

                        <a href="/categories/{{ $subName | urlize }}/" class="sub-category-item">
                            <span class="sub-icon">â””â”€</span>
                            <span class="sub-name">{{ $subName }}</span>
                            <span class="sub-count">{{ $count }}</span>
                        </a>
                    {{ end }}
                </div>
            </details>
        {{ end }}
    </section>

    {{ partialCached "footer/footer" . }}
{{ end }}

{{ define "right-sidebar" }}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{ end }}

<style>
.hierarchical-categories-page {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.main-category-block {
    background: var(--card-background);
    border-radius: var(--card-border-radius);
    padding: 1.5rem;
    box-shadow: var(--shadow-l1);
    border: 1px solid var(--card-separator-color);
}

.main-category-title {
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    list-style: none;
}

.main-category-title::-webkit-details-marker {
    display: none;
}

.category-icon {
    font-size: 1.2rem;
}

.main-category-title a {
    color: var(--accent-color);
    text-decoration: none;
}

.main-category-title a:hover {
    text-decoration: underline;
}

.sub-categories-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-left: 2rem;
}

.sub-category-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--body-background);
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1px solid transparent;
}

.sub-category-item:hover {
    border-color: var(--accent-color);
    transform: translateX(4px);
}

.sub-icon {
    color: var(--card-text-color-tertiary);
    font-family: monospace;
}

.sub-name {
    flex: 1;
    color: var(--card-text-color-main);
    font-weight: 500;
}

.sub-count {
    color: var(--card-text-color-secondary);
    background: var(--card-background);
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.85em;
    font-weight: 600;
}
</style>
