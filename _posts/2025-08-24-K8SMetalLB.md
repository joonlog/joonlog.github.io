---
title : Kubernetes MetalLB
date : 2025-08-24 09:00:00 +09:00
categories : [Kubernetes, Plugins]
tags : [kubernetes, k8s, metallb, k8s loadbalancer]  #소문자만 가능
---

> https://metallb.universe.tf/installation/
> 
- 클러스터 내부용 로드밸런서
    - 오픈소스
    - CSP의 LB를 사용하지 못하는 경우(내/외부 양쪽에서 사용가능한 LB)에, 내부용 L4 로드밸런서로 사용하기 위해 주로 MetalLB를 사용

### 사전 준비

- kube-proxy의 configmap에서 strictARP 활성화

```bash
kubectl edit configmap -n kube-system kube-proxy

apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: "ipvs"
ipvs:
  strictARP: true
```

### MetalLB 설치

- helm으로 설치

```bash
helm repo add metallb https://metallb.github.io/metallb
helm install metallb metallb/metallb
```

### MetalLB 설정

- IP Pool 설정

```bash
cat <<EOF | kubectl apply -f -
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: default-pool
  namespace: default
spec:
  addresses:
  - 172.27.1.100-172.27.1.110
EOF
```

- L2Advertisement 설정

```bash
cat <<EOF | kubectl apply -f -
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: default
  namespace: default
spec:
  ipAddressPools:
  - default-pool
EOF
```